name: Valgrind

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: apt install dependency
      run: |
        sudo apt-get -y install valgrind
        sudo apt-get -y install libcunit1 libcunit1-doc libcunit1-dev 
    - name: Install Cunit
      run: sudo apt-get -y install libcunit1 libcunit1-doc libcunit1-dev
    - name: Install gtest manually
      run: sudo apt-get install libgtest-dev && cd /usr/src/gtest && sudo cmake CMakeLists.txt && sudo make && sudo cp *.a /usr/lib && sudo ln -s /usr/lib/libgtest.a /usr/local/lib/libgtest.a && sudo ln -s /usr/lib/libgtest_main.a /usr/local/lib/libgtest_main.a
    - name: make all
      run: |
        all: all.out
all.out: Movie.o MovieLang.o Moviedb.o Movie-test.o Moviedb-test.o
  g++ $^ -o $@ -lgtest -lgtest_main -lpthread
Moviedb-test.o: Moviedb-test.cpp Movie.h MovieLang.h Moviedb.h
  g++ $< -c
Movie-test.o: Movie-test.cpp Movie.h MovieLang.h
  g++ $< -c
Moviedb.o: Moviedb.cpp Moviedb.h MovieLang.h Movie.h
  g++ $< -c
MovieLang.o: MovieLang.cpp MovieLang.h Movie.h
  g++ $< -c
Movie.o: Movie.cpp Movie.h
  g++ $< -c
clean:
  rm -rf *.o *.out

        valgrind ./all.out
